<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <style>
        body {
            background-color: #000000; 
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s;
        }

        #ascii-container {
            /* Container to group the grid and the button */
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
            margin: 2rem;
        }

        #ascii-grid {
            font-family: 'Courier New', monospace;
            white-space: pre;
            line-height: 1; 
            font-size: 0.9rem;
            
            /* Removed window/scroll properties */
            overflow: visible; 
            padding: 0; 
            background-color: transparent; 
            
            color: #ffffff; 
            
            /* Remove box shadow and radius to make it flush with the background */
            border-radius: 0;
            box-shadow: none; 
            
            /* Margin set to 0 */
            margin: 0 auto; 
            max-width: fit-content;
            transition: color 0.3s, box-shadow 0.3s;
        }

        #theme-toggle {
            padding: 0.5rem 1rem;
            border: 2px solid;
            border-radius: 0.5rem;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            background: transparent;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Small margin bottom to separate slightly from the jar */
            margin-bottom: 0.25rem;
        }
        
        #theme-toggle svg {
            width: 20px;
            height: 20px;
            transition: stroke 0.3s;
        }

        /* Initial Dark Mode Colors for the Button (Moon Icon) */
        #theme-toggle.dark-mode {
            color: #ffffff;
            border-color: #ffffff;
        }
        #theme-toggle.dark-mode svg {
            stroke: #ffffff;
        }
        #theme-toggle.dark-mode:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Light Mode Colors for the Button (Sun Icon) */
        #theme-toggle.light-mode {
            color: #000000;
            border-color: #000000;
        }
        #theme-toggle.light-mode svg {
            stroke: #000000;
        }
        #theme-toggle.light-mode:hover {
            background: rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div id="ascii-container">
        <!-- Button moved above the grid -->
        <button id="theme-toggle" aria-label="Toggle theme"></button>
        <pre id="ascii-grid">Loading ASCII Render...</pre>
    </div>

    <script>
        window.onload = function () {
            const PI = Math.PI;
            const GRID_SIZE = 60; 
            const X_MIN = -3.2;
            const X_MAX = 3.2;
            const Y_MIN = -5.5;
            const Y_MAX = 5.5;

            const STEP_X = (X_MAX - X_MIN) / GRID_SIZE;
            const STEP_Y = (Y_MAX - Y_MIN) / GRID_SIZE;

            let currentOffset = 0; 
            const SCROLL_SPEED = 0.2; 

            const MASTER_SEQUENCE = [
                'b', 'o', 'b', '#', '#', '#', '#', '#', '#', '#', 
                
                'b', 'o', 'b', '@', '@', '@', '@', '@', '@', '@', 
                
                'b', 'o', 'b', '%', '%', '%', '%', '%', '%', '%', 
                
                'b', 'o', 'b', '*', '*', '*', '*', '*', '*', '*', 
                
                'b', 'o', 'b', '-', '-', '-', '-', '-', '-', '-', 
                
                'b', 'o', 'b', '=', '=', '=', '=', '=', '=', '='
            ]; 
            
            const EMPTY_CHAR = ' ';
            
            const patternLength = MASTER_SEQUENCE.length; 
            
            const SYNCH_FACTOR = GRID_SIZE / patternLength; 
            
            const bodyElement = document.body;
            const gridElement = document.getElementById('ascii-grid');
            const toggleButton = document.getElementById('theme-toggle');
            
            let isDarkMode = true; 

            const sunIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>`;
            const moonIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>`;


            function getMaxY(x) {
                const y_circle = Math.sqrt(9 - x * x);
                if (Math.abs(x) < 1.69257) {
                    return 3;
                }
                return isNaN(y_circle) ? -Infinity : y_circle;
            }

            function getMinY(x) {
                const y_circle = -Math.sqrt(9 - x * x);
                if (Math.abs(x) < 0.99336) {
                    return -3.1;
                }
                return isNaN(y_circle) ? +Infinity : y_circle;
            }

            function updateThemeAppearance() {
                if (isDarkMode) {
                    bodyElement.style.backgroundColor = '#000000';
                    gridElement.style.color = '#ffffff';
                    toggleButton.innerHTML = sunIcon; 
                    toggleButton.classList.remove('light-mode');
                    toggleButton.classList.add('dark-mode');
                    toggleButton.setAttribute('aria-label', 'Switch to Light Mode (Sun Icon)');
                } else {
                    bodyElement.style.backgroundColor = '#ffffff';
                    gridElement.style.color = '#000000';
                    toggleButton.innerHTML = moonIcon; 
                    toggleButton.classList.remove('dark-mode');
                    toggleButton.classList.add('light-mode');
                    toggleButton.setAttribute('aria-label', 'Switch to Dark Mode (Moon Icon)');
                }
            }
            
            function toggleTheme() {
                isDarkMode = !isDarkMode;
                updateThemeAppearance();
            }

            toggleButton.addEventListener('click', toggleTheme);
            updateThemeAppearance(); 

            function animate() {
                let output = '';

                const totalShift = currentOffset; 
                
                const totalColumnShift = Math.floor(totalShift * patternLength);

                for (let i = 0; i < GRID_SIZE; i++) {
                    const y_grid = Y_MAX - i * STEP_Y - (STEP_Y / 2);

                    for (let j = 0; j < GRID_SIZE; j++) {
                        const x_grid = X_MIN + j * STEP_X + (STEP_X / 2);

                        const y_max = getMaxY(x_grid);
                        const y_min = getMinY(x_grid);

                        if (y_grid <= y_max && y_grid >= y_min) {
                            
                            const shiftedColumnIndex = (j + totalColumnShift + GRID_SIZE) % GRID_SIZE;

                            const charIndex = Math.floor(shiftedColumnIndex / SYNCH_FACTOR);
                            
                            output += MASTER_SEQUENCE[charIndex % patternLength];
                        } else {
                            output += EMPTY_CHAR;
                        }
                    }
                    output += '\n';
                }

                if (output.endsWith('\n')) {
                    output = output.slice(0, -1);
                }

                gridElement.textContent = output;

                currentOffset += SCROLL_SPEED * (1 / 60); 
                if (currentOffset >= SYNCH_FACTOR) {
                    currentOffset -= SYNCH_FACTOR;
                }

                requestAnimationFrame(animate);
            }

            animate();
        };
    </script>
</body>
</html>
